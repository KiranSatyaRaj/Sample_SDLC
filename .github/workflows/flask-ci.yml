name: Flask CI-CD

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  test-and-deploy:
     runs-on: ubuntu-latest

     steps:
       - name: Checkout repository
         uses: actions/checkout@v4
         
       - name: List all files
         run: |
             ls -a
       - name: SSH into ec2
         run: |
            mkdir -p ~/.ssh
            echo "${{ secrets.SSH_KEY }}" > ~/.ssh/ec2-key.pem
            chmod 600 ~/.ssh/ec2-key.pem
            ssh-keyscan -H ${{ secrets.SSH_HOST }} >> ~/.ssh/known_hosts
            ssh -i ~/.ssh/ec2-key.pem ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }} << 'EOF'
            set -e
            echo "I'm inside aws ec2 instance. WOOHOO!!!!"
            ls -a
            EOF
